!function(e,t){"function"==typeof define&&define.amd?(e.marked=require("./marked"),e.RevealMarkdown=t(e.marked)):"object"==typeof exports?module.exports=t(require("./marked")):e.RevealMarkdown=t(e.marked)}(this,function(r){var t="^\r?\n---\r?\n$",a="notes?:",n="__SCRIPT_END__";function s(e){var t=(e.querySelector("[data-template]")||e.querySelector("script")||e).textContent,a=(t=t.replace(new RegExp(n,"g"),"<\/script>")).match(/^\n?(\s*)/)[1].length,r=t.match(/^\n?(\t*)/)[1].length;return 0<r?t=t.replace(new RegExp("\\n?\\t{"+r+"}","g"),"\n"):1<a&&(t=t.replace(new RegExp("\\n? {"+a+"}","g"),"\n")),t}function i(e){for(var t=e.attributes,a=[],r=0,n=t.length;r<n;r++){var o=t[r].name,s=t[r].value;/data\-(markdown|separator|vertical|notes)/gi.test(o)||(s?a.push(o+'="'+s+'"'):a.push(o))}return a.join(" ")}function h(e){return(e=e||{}).separator=e.separator||t,e.notesSeparator=e.notesSeparator||a,e.attributes=e.attributes||"",e}function m(e,t){t=h(t);var a=e.split(new RegExp(t.notesSeparator,"mgi"));return 2===a.length&&(e=a[0]+'<aside class="notes">'+r(a[1].trim())+"</aside>"),'<script type="text/template">'+(e=e.replace(/<\/script>/g,n))+"<\/script>"}function l(e,t){t=h(t);for(var a,r,n,o=new RegExp(t.separator+(t.verticalSeparator?"|"+t.verticalSeparator:""),"mg"),s=new RegExp(t.separator),i=0,l=!0,u=[];a=o.exec(e);)notes=null,!(r=s.test(a[0]))&&l&&u.push([]),n=e.substring(i,a.index),r&&l?u.push(n):u[u.length-1].push(n),i=o.lastIndex,l=r;(l?u:u[u.length-1]).push(e.substring(i));for(var d="",c=0,p=u.length;c<p;c++)u[c]instanceof Array?(d+="<section "+t.attributes+">",u[c].forEach(function(e){d+="<section data-markdown>"+m(e,t)+"</section>"}),d+="</section>"):d+="<section "+t.attributes+" data-markdown>"+m(u[c],t)+"</section>";return d}function o(){return new Promise(function(e){var t=[];[].slice.call(document.querySelectorAll("[data-markdown]")).forEach(function(a,e){var o;a.getAttribute("data-markdown").length?t.push((o=a,new Promise(function(a,r){var t=new XMLHttpRequest,n=o.getAttribute("data-markdown");datacharset=o.getAttribute("data-charset"),null!=datacharset&&""!=datacharset&&t.overrideMimeType("text/html; charset="+datacharset),t.onreadystatechange=function(e,t){4===t.readyState&&(200<=t.status&&t.status<300||0===t.status?a(t,n):r(t,n))}.bind(this,o,t),t.open("GET",n,!0);try{t.send()}catch(e){alert("Failed to get the Markdown file "+n+". Make sure that the presentation and the file are served by a HTTP server and the file can be found there. "+e),a(t,n)}})).then(function(e,t){a.outerHTML=l(e.responseText,{separator:a.getAttribute("data-separator"),verticalSeparator:a.getAttribute("data-separator-vertical"),notesSeparator:a.getAttribute("data-separator-notes"),attributes:i(a)})},function(e,t){a.outerHTML='<section data-state="alert">ERROR: The attempt to fetch '+t+" failed with HTTP status "+e.status+".Check your browser's JavaScript console for more details.<p>Remember that you need to serve the presentation HTML from a HTTP server.</p></section>"})):a.getAttribute("data-separator")||a.getAttribute("data-separator-vertical")||a.getAttribute("data-separator-notes")?a.outerHTML=l(s(a),{separator:a.getAttribute("data-separator"),verticalSeparator:a.getAttribute("data-separator-vertical"),notesSeparator:a.getAttribute("data-separator-notes"),attributes:i(a)}):a.innerHTML=m(s(a))}),Promise.all(t).then(e)})}function u(e,t,a){var r=new RegExp(a,"mg"),n=new RegExp('([^"= ]+?)="([^"=]+?)"',"mg"),o=e.nodeValue;if(matches=r.exec(o)){var s=matches[1];for(o=o.substring(0,matches.index)+o.substring(r.lastIndex),e.nodeValue=o;matchesClass=n.exec(s);)t.setAttribute(matchesClass[1],matchesClass[2]);return!0}return!1}function d(){var e=document.querySelectorAll("[data-markdown]:not([data-markdown-parsed])");return[].slice.call(e).forEach(function(e){e.setAttribute("data-markdown-parsed",!0);var t=e.querySelector("aside.notes"),a=s(e);e.innerHTML=r(a),function e(t,a,r,n,o){if(null!=a&&null!=a.childNodes&&0<a.childNodes.length){previousParentElement=a;for(var s=0;s<a.childNodes.length;s++){if(childElement=a.childNodes[s],0<s)for(j=s-1;0<=j;){if(aPreviousChildElement=a.childNodes[j],"function"==typeof aPreviousChildElement.setAttribute&&"BR"!=aPreviousChildElement.tagName){previousParentElement=aPreviousChildElement;break}j-=1}parentSection=t,"section"==childElement.nodeName&&(parentSection=childElement,previousParentElement=childElement),"function"!=typeof childElement.setAttribute&&childElement.nodeType!=Node.COMMENT_NODE||e(parentSection,childElement,previousParentElement,n,o)}}a.nodeType==Node.COMMENT_NODE&&0==u(a,r,n)&&u(a,t,o)}(e,e,null,e.getAttribute("data-element-attributes")||e.parentNode.getAttribute("data-element-attributes")||"\\.element\\s*?(.+?)$",e.getAttribute("data-attributes")||e.parentNode.getAttribute("data-attributes")||"\\.slide:\\s*?(\\S.+?)$"),t&&e.appendChild(t)}),Promise.resolve()}var e={init:function(e){if(void 0===r)throw"The reveal.js Markdown plugin requires marked to be loaded";"undefined"!=typeof hljs&&r.setOptions({highlight:function(e,t){return hljs.highlightAuto(e,[t]).value}});var t=Reveal.getConfig().markdown;return t&&r.setOptions(t),o().then(d)},processSlides:o,convertSlides:d,slidify:l};return Reveal.registerPlugin("markdown",e),e});